<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

        <link rel="stylesheet" type="text/css" href="/index.css" />
        <link rel="stylesheet" type="text/css" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
        <title>WhereBear Admin</title>
    </head>
    <body>

        <!--
            Admin- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
        -->
        <div data-role="page" id="admin">
            <div data-role="content">
                <p class="status">{{status}}</p>
                <div data-role="controlgroup" id="venueButtons">
                    <a data-role="button" href="#specialPage" data-icon="plus" data-iconpos="left" id="addSpecialButton">Add Special</a>
                    <a data-role="button" href="#venuePage" data-icon="home" data-iconpos="left" id="addVenueButton">Add Venue</a>
                    <a data-role="button" href="#deleteSpecialPage" data-icon="minus" data-iconpos="left" id="deleteSpecialButton">Remove Special</a>
                    <a data-role="button" href="#deleteVenuePage" data-icon="minus" data-iconpos="left" id="deleteVenueButton">Remove Venue</a>
                    <a data-role="button" data-icon="back" data-ajax="false" data-iconpos="left" href="/logout" id="logoutButton">Logout</a>
                </div>
            </div>
        </div>

        <!--
            Add Venue - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
        -->
        <div data-role="page" id="venuePage">
            <div data-role="content">
                <div data-role="fieldcontain" class="ui-hide-label" id="venueWrap">
                    <form action="/venueAdd" method="post">
                        <label for="venueCity">City</label>
                        <select name="venueCity" id="venueCity">
                            <option value="Ithaca">Ithaca</option>
                            <option value="New York City" selected="selected">New York City</option>
                        </select>
                        <div class="space"></div>
                        <label for="venueName">Name</label>
                        <input type="text" placeholder="Penny Farthing's" name="venueName" id="venueName" value="" />
                        <div class="space"></div>
                        <label for="venueAddress">Address</label>
                        <input type="text" placeholder="64 W 85th Street" name="venueAddress" id="venueAddress" value="" />
                        <div class="space"></div>
                        <input type="hidden" name="venueState" id="venueState" value="NY" />
                        <input type="submit" value="Submit" id="submitVenue" />
                    </form>
                </div>
                <a data-role="button" href="#admin" data-icon="delete" id="adminButton">Cancel</a>
            </div>
        </div>

        <!--
            Add Special - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
        -->
        <div data-role="page" id="specialPage">
            <div data-role="content">
                <form action="/specialAdd" method="post">
                    <select name="specialCity" id="specialCity">
                        <option value="new york city">New York City</option>
                        <option selected="selected" value="ithaca">Ithaca</option>
                    </select>
                    <select name="specialVenue" id="specialVenue">
                        <option value="">Select a Venue</option>
                    </select>
                    <div class="space"></div>
                    <input type="text" placeholder="1/2 Pound BBQ Wings" name="specialDescription" id="specialDescription" value="" />
                    <div class="space"></div>
                    <fieldset data-role="controlgroup" data-mini="true" data-type="horizontal">
                       <input type="checkbox" name="specialDay[]" id="specialSunday" value="1"/>
                       <label for="specialSunday">Sunday</label>
                       <input type="checkbox" name="specialDay[]" id="specialMonday" value="2"/>
                       <label for="specialMonday">Monday</label>
                       <input type="checkbox" name="specialDay[]" id="specialTuesday" value="3"/>
                       <label for="specialTuesday">Tuesday</label>
                       <input type="checkbox" name="specialDay[]" id="specialWednesday" value="4"/>
                       <label for="specialWednesday">Wednesday</label>
                       <input type="checkbox" name="specialDay[]" id="specialThursday" value="5"/>
                       <label for="specialThursday">Thursday</label>
                       <input type="checkbox" name="specialDay[]" id="specialFriday" value="6"/>
                       <label for="specialFriday">Friday</label>
                       <input type="checkbox" name="specialDay[]" id="specialSaturday" value="7"/>
                       <label for="specialSaturday">Saturday</label>
                    </fieldset>
                    <div class="space"></div>
                    <input type="time" name="specialStart" id="specialStart" placeholder="start" data-mini="true"/>
                    <div class="space"></div>
                    <input type="time" name="specialEnd" id="specialEnd" placeholder="end" data-mini="true"/>
                    <div class="space"></div>
                    <fieldset data-role="controlgroup" data-mini="true" data-type="horizontal">
                       <input type="radio" name="specialAmount[]" id="specialPrice" value="price" checked="checked"/>
                       <label for="specialPrice">Price</label>
                       <input type="radio" name="specialAmount[]" id="specialDiscount" value="discount"/>
                       <label for="specialDiscount">Discount</label>
                    </fieldset>
                    <div class="space"></div>
                    <input type="number" placeholder="3.99 price or .2 discount" step="0.01" min="0" name="specialValue" id="specialValue" value="" />
                    <div class="space"></div>
                    <fieldset data-role="controlgroup" data-mini="true" data-type="horizontal">
                       <input type="radio" name="specialType[]" class="specialType" id="specialDrink" value="drink" checked="checked"/>
                       <label for="specialDrink">Drink</label>
                       <input type="radio" name="specialType[]" class="specialType" id="specialFood" value="food"/>
                       <label for="specialFood">Food</label>
                       <input type="radio" name="specialType[]" class="specialType" id="specialEvent" value="event"/>
                       <label for="specialEvent">Event</label>
                       <input type="radio" name="specialType[]" class="specialType" id="specialOneDay" value="oneday"/>
                       <label for="specialOneDay">One Day</label>
                    </fieldset>
                    <div class="space"></div>
                    <div style="display:none;" id="specialDateWrap">
                        <input type="date" name="specialDate" id="specialDate" />
                        <div class="space"></div>
                    </div>
                    <input type="submit" value="Submit" id="submitSpecial" />
                </form>
                
                <a data-role="button" href="#admin" data-icon="delete">Cancel</a>
            </div>
        </div>

        <!--
            Remove Special - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
        -->
        <div data-role="page" id="deleteSpecialPage">
            <div data-role="content">
                <a data-role="button" href="#admin" data-icon="back">Cancel</a>
                <select name="specialVenueDelete" id="specialVenueDelete">
                </select>
                <form action="/specialDelete" method="post">
                    <select name="specialDelete" id="specialDelete"><option value=""></option></select>
                    <input type="submit" data-ajax="false" id="deleteSpecialSubmit" value="Delete" />
                </form>
            </div>
        </div>

        <!--
            Remove Venue - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
        -->
        <div data-role="page" id="deleteVenuePage">
            <div data-role="content">
                <form action="/venueDelete" method="post">
                    <a data-role="button" href="#admin" data-icon="back">Cancel</a>
                    <select name="venueDelete" id="venueDeleteSelect"><option value=""></option></select>
                    <input type="submit" data-ajax="false" id="deleteVenueSubmit" value="Delete" />
                </form>
            </div>
        </div>

        <!--
            Javascript Files - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
        -->
        <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script type="text/javascript" src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
        <script>
            function fillVenues(div) {
                $(div).html("<option value=''>Select a Venue</option>").selectmenu('refresh');
                var request = $.ajax({
                    url: "/venues",
                    type: "GET",
                    data: {city:escape($('#specialCity').val())},
                    dataType: "json"
                });

                request.done(function(json) {
                    if(json.error) {
                        console.log(json.errorMessage);
                    } else {
                        $.each(json.data,function(i,item){
                            $(div).append('<option value="'+item.venue_id+'">'+unescape(item.name)+'</option');
                        });
                    }
                });

                request.fail(function(jqXHR, textStatus) {
                    alert( "Request failed: " + textStatus);
                });
            }

            function fillSpecials(div,venue_id) {
                $('#specialDelete').html("<option value=''>Select a Special</option>").selectmenu('refresh');
                var request = $.ajax({
                    url: "/specials/venue",
                    type: "GET",
                    data: {venue_id: venue_id},
                    dataType: "json"
                });

                request.done(function(json) {
                    if(json.error) {
                        console.log(json.errorMessage);
                    } else {
                        $.each(json.data,function(i,item){
                            $(div).append('<option value="'+item.special_id+'">'+unescape(item.description)+'</option');
                        });
                    }
                });

                request.fail(function(jqXHR, textStatus) {
                    alert( "Request failed: " + textStatus);
                });
            }

            $(document).on("pageshow", "#deleteVenuePage", function(){
                //fillVenues('#venueDeleteSelect');
            }).on('pageshow','#specialPage',function(){
                fillVenues('#specialVenue');
            }).on('pageshow','#deleteVenuePage',function(){
                $('#venueDeleteSelect').html("<option value=''>Select a Special</option>").selectmenu('refresh');
                fillVenues('#venueDeleteSelect');
            }).on('pageshow','#deleteSpecialPage',function(){
                $('#specialDelete').html("<option value=''>Select a Special</option>").selectmenu('refresh');
                fillVenues('#specialVenueDelete');
            }).ready(function(){
                $('#specialVenueDelete').bind( "change", function(event, ui) {
                    fillSpecials('#specialDelete',$('#specialVenueDelete').val());
                });
                $('.specialType').bind( "click", function(event, ui) {
                    if($(this).val()=='oneday') {
                        $('#specialDateWrap').show();
                    } else {
                        $('#specialDateWrap').hide();
                    }
                });
            });


        </script>
    </body>
</html>
